==
<?php

use Illuminate\Support\Facades\Session;
use October\Rain\Support\Facades\Http;
function onStart()
  {
      $path = request()->path();
      $user = \Auth::getUser();
      if (isset($user->name)) {
        if (!empty($user->programs) && isset($user->programs[0]->name)) {
            $programName = $user->programs[0]->name;
        } else {
            $programName = '';
        }
        if(Session::has('unique_visitor_id')){
          $uniqueVisitorId = Session::get('unique_visitor_id');
          $pageViewExists = \Codengine\Awardbank\Models\GoogleAnalytics::where('user_id',$user->slug)
              ->where('session_id', $uniqueVisitorId)
              ->where('page', $path)
              ->first();
              info($uniqueVisitorId);
          if (!$pageViewExists) {
              // Save the unique page view data to the database
              \Codengine\Awardbank\Models\GoogleAnalytics::create([
                'page' => $path,
                'user_name' => $user->name.' '.$user->surname,
                'user_id' => $user->slug,
                'program_name' => $programName,
                'email' => $user->email,
                'session_id' => $uniqueVisitorId,
                'unique_page_views' => 1,
              ]);
          }else{
            $pageViewExists->increment('unique_page_views');
          }
        }else{
          $uniqueVisitorId = uniqid();
          Session::put('unique_visitor_id', $uniqueVisitorId);
          \Codengine\Awardbank\Models\GoogleAnalytics::create([
            'page' => $path,
            'user_name' => $user->name.' '.$user->surname,
            'user_id' => $user->slug,
            'program_name' => $programName,
            'email' => $user->email,
            'session_id' => $uniqueVisitorId,
            'unique_page_views' => 1,
          ]);
        }
      }
    }
?>
==
<!DOCTYPE html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>{{ page.title }}</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        {% partial 'ga' %}
        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-P6CN26D');</script>
        <!-- End Google Tag Manager -->
        <!-- Place favicon.ico in the root directory -->
        <link rel="stylesheet" href="{{[
            'assets/vendor/datepicker/css/bootstrap-datepicker3.css',
            'assets/dist/semantic.min.css',
            'assets/vendor/slick/slick.min.css',
            'assets/less/magic.less',
        ]|theme }}" />
        {% styles %}
    </head>
    <body class="admin">
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P6CN26D"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
        <div class="site-container">
            {% partial 'site/header-v2' %}
            <!--Begin Container-->
            <div class="ui bottom attached pushable">
                <div class="ui left inline vertical sidebar menu sidebar-nav">
                    {{ Sidebar.html1|raw }}
                </div>
                <div class="pusher header-margin">
                    {% page %}
                    {% partial 'site/footer-v2' %}
                </div>
            </div>
        </div>
        <!--Finish Container-->
        <div class="ui modal long">
            <div class="header"></div>
            <div class="content"></div>
            <div class="actions"></div>
        </div>
        <script src="{{[
            'assets/js/vendor/jquery.min.js',
            'assets/vendor/slick/slick.min.js',
            'assets/vendor/datepicker/js/bootstrap-datepicker.js',
            'assets/dist/semantic.min.js',
            'assets/js/globals111219.js',
        ]|theme }}"></script>
        {% framework extras %}
        {% scripts %}
    </body>
</html>
