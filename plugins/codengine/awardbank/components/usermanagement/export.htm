{% if manager == true %}
<div class="ui segment">
    <h3>User Export</h3>

    <form class="ui form" id="filters">
        <div class="ui grid two columns">
            <div class="column">
                <div class="field">
                    <label>Created At Start Range</label>
                    <div class="ui calendar">
                        <div class="ui input left icon">
                            <i class="calendar icon"></i>
                            <input type="date" name="created_at_start" value="{{ default_start_date }}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div class="field">
                    <label>Created At End Range</label>
                    <div class="ui calendar">
                        <div class="ui input left icon">
                            <i class="calendar icon"></i>
                            <input type="date" name="created_at_end" value="{{ default_end_date }}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="ui grid one columns">
        <div class="column">
            <button class="ui primary filter export button users-management-report" data-id="users" data-attach-loading="">Export</button>
        </div>
    </div>
</div>

<div class="ui segment">
    <h3>Users Wishlist Export</h3>

    <div class="ui grid one columns">
        <div class="column">
            <button class="ui primary filter export button users-management-report" data-id="wishlist" data-attach-loading="">Export</button>
        </div>
    </div>
</div>

{% put scripts %}

<script>
  $('body').on('click','.filter.export.button.users-management-report', function(e) {
    e.preventDefault();

    let action = $(this).attr('data-id');
    if (action) {
      let exportMethod = action == 'wishlist' ? 'onExportUsersWishlist' : 'onExportUsers';
      let exportFileName = action == 'wishlist' ? 'UserWishlistExport.csv' : 'UserExport.csv';

      var inputs = $('#filters :input');
      var data = {};
      inputs.each(function() {
        data[this.name] = $(this).val();
      });

      target = $(this);
      target.addClass('loading');
      $.request(exportMethod, {
        data: data,
        success: function(response)
        {
          if (response.manualerror) {
            alert(response.manualerror);
            target.removeClass('loading');
            return false;
          }
          // The actual download
          // Note: Code has been copied from MyProgram231219.js
          var blob = new Blob([response], { type: 'text/csv' });
          var link = document.createElement('a');
          link.href = window.URL.createObjectURL(blob);
          link.download = exportFileName;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          target.removeClass('loading');
        },
        error: function(data){
          throw data;
        },
      });
    }
  });
</script>

{% endput %}
{% endif %}
